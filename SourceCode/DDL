/*
=============================================================
Create Database and Schemas for Data Warehouse
=============================================================
Script Purpose:
    This script creates a new database named 'DWH' after checking if it already exists.
    If the database exists, it will be dropped and recreated.
    dimensional and fact tables for analytics and reporting.

WARNING:
    Running this script will drop the entire 'DWH' database if it exists. 
    All data in the database will be permanently deleted. 
    Proceed with caution and ensure you have proper backups before running this script.
=============================================================
*/
USE master;
GO


---- DROP and recreate the 'DWH' database

IF EXISTS ( SELECT 1 FROM sys.databases WHERE name = 'DWH')
BEGIN
	ALTER DATABASE DWH SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
	DROP DATABASE DWH;
END;
GO

-- CREATE DWH
CREATE DATABASE DWH;
GO

USE DWH;
GO


-- DIM CUSTOMER
IF OBJECT_ID('DimCustomer','U') IS NOT NULL
	DROP TABLE DimCustomer;
GO
CREATE TABLE DimCustomer(
	CustomerID INT NOT NULL PRIMARY KEY,
	CustomerName VARCHAR(100),
	Address VARCHAR(200),
	CityName VARCHAR(100),
	StateName VARCHAR(100),
	Age INT,
	Gender VARCHAR(20),
	Email VARCHAR (200)
);

-- DIM ACCOUNT
IF OBJECT_ID('DimAccount','U') IS NOT NULL
	DROP TABLE DimAccount;
GO
CREATE TABLE DimAccount(
	AccountID INT NOT NULL PRIMARY KEY,
	CustomerID INT,
	AccountType VARCHAR(50),
	Balance DECIMAL (18,2),
	DateOpened DATE,
	Status VARCHAR(20),
	CONSTRAINT FK_Account_Customer FOREIGN KEY (CustomerID) REFERENCES DimCustomer(CustomerID)
)

-- DIM BRANCH
IF OBJECT_ID('DimBranch','U') IS NOT NULL
	DROP TABLE DimBranch;
GO
CREATE TABLE DimBranch(
	BranchID INT NOT NULL PRIMARY KEY,
	BranchName VARCHAR(200),
	BranchLocation VARCHAR(200),)


-- FACT TRANSACTION
IF OBJECT_ID('FactTransaction','U') IS NOT NULL
	DROP TABLE FactTransaction;
GO
CREATE TABLE FactTransaction(
	TransactionID INT PRIMARY KEY NOT NULL,
	AccountID INT,
	BranchID INT,
	TransactionDate DATETIME2,
	Amount DECIMAL(10,2),
	TransactionType VARCHAR(100),
	CONSTRAINT FK_Fact_Account FOREIGN KEY (AccountID) REFERENCES DimAccount(AccountID),
	CONSTRAINT FK_Fact_Branch FOREIGN KEY (BranchID) REFERENCES DimBranch(BranchID)
)
